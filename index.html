<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mein Punkte-Tracker</title>
  <style>
    body {
      font-family: "Comic Sans MS", cursive, sans-serif;
      background: #fdf6e3;
      margin: 20px;
      color: #333;
    }
    h1, h2, h3 {
      color: #2a7f62;
    }
    .task-group {
      margin-bottom: 20px;
      padding: 15px;
      border: 2px solid #cce5cc;
      border-radius: 10px;
      background: #ffffff;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    button {
      background: #80cfa9;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #5bbf91;
    }
    #points-display {
      font-weight: bold;
      font-size: 1.4em;
      margin-top: 20px;
      background: #fff3cd;
      padding: 10px;
      border-radius: 10px;
      border: 2px dashed #ffcc00;
      width: fit-content;
    }
    .shop-item {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ‰ Mein Punkte-Tracker ğŸ‰</h1>

  <div class="task-group" id="morning-tasks">
    <h2>ğŸŒ… Morgens</h2>
    <label><input type="checkbox" data-task="aufstehen" onclick="completeTask(this, '06:25', 5)"> Aufstehen vor 6:25 Uhr</label>
    <label><input type="checkbox" data-task="essen" onclick="completeTask(this, null, 2)"> FrÃ¼hstÃ¼ck essen</label>
    <label><input type="checkbox" data-task="zaehne" onclick="completeTask(this, '06:40', 3)"> ZÃ¤hne putzen um 6:40 Uhr</label>
    <label><input type="checkbox" data-task="haare" onclick="completeTask(this, '06:45', 2)"> Haare kÃ¤mmen um 6:45 Uhr</label>
  </div>

  <button onclick="startAfternoon()">â¡ï¸ Nachmittag starten</button>

  <div class="task-group" id="afternoon-tasks" style="display:none;">
    <h2>â˜€ï¸ Nachmittag</h2>
    <div id="weekday-tasks"></div>
    <h3>ğŸ§½ TÃ¤glich:</h3>
    <label><input type="checkbox" data-task="abrÃ¤umen-morgens" onclick="completeTask(this, null, 1)"> Tisch abrÃ¤umen (morgens)</label>
    <label><input type="checkbox" data-task="abrÃ¤umen-mittags" onclick="completeTask(this, null, 1)"> Tisch abrÃ¤umen (mittags)</label>
    <label><input type="checkbox" data-task="abrÃ¤umen-abends" onclick="completeTask(this, null, 1)"> Tisch abrÃ¤umen (abends)</label>
  </div>

  <div id="points-display">Punkte: 0</div>

  <div class="task-group">
    <h2>ğŸ Belohnungen einlÃ¶sen</h2>
    <div class="shop-item"><button onclick="redeemTabletReward()">1 Stunde Tabletzeit (10 Punkte, nur mit 4 guten Tagen)</button></div>
    <div class="shop-item"><button onclick="redeemReward(5, '1 Folge Serie')">1 Folge Serie (5 Punkte)</button></div>
    <div class="shop-item"><button onclick="redeemReward(8, '1 Stunde mit Mama spielen')">1 Stunde mit Mama spielen (8 Punkte)</button></div>
    <div class="shop-item"><button onclick="redeemReward(8, '1 Stunde mit Papa spielen')">1 Stunde mit Papa spielen (8 Punkte)</button></div>
  </div>

  <script>
    let points = parseInt(localStorage.getItem("points")) || 0;
    let taskStates = JSON.parse(localStorage.getItem("taskStates")) || {};
    let dayScores = JSON.parse(localStorage.getItem("dayScores")) || {};
    const today = new Date().toLocaleDateString();

    function completeTask(checkbox, deadline, taskPoints) {
      const taskKey = checkbox.getAttribute("data-task") + "-" + today;
      const now = new Date();

      if (deadline) {
        const [h, m] = deadline.split(":");
        const deadlineTime = new Date();
        deadlineTime.setHours(h, m, 0, 0);
        if (now > deadlineTime) {
          alert("Diese Aufgabe ist zu spÃ¤t erledigt.");
          checkbox.checked = false;
          return;
        }
      }

      if (checkbox.checked && !taskStates[taskKey]) {
        points += taskPoints;
        taskStates[taskKey] = true;
        if (!dayScores[today]) dayScores[today] = 0;
        dayScores[today] += taskPoints;
      } else if (!checkbox.checked && taskStates[taskKey]) {
        points -= taskPoints;
        taskStates[taskKey] = false;
        dayScores[today] -= taskPoints;
      }

      saveState();
      updatePointsDisplay();
    }

    function updatePointsDisplay() {
      document.getElementById("points-display").innerText = `Punkte: ${points}`;
    }

    function saveState() {
      localStorage.setItem("points", points);
      localStorage.setItem("taskStates", JSON.stringify(taskStates));
      localStorage.setItem("dayScores", JSON.stringify(dayScores));
    }

    function loadTaskCheckboxes() {
      const checkboxes = document.querySelectorAll("input[type='checkbox']");
      checkboxes.forEach(cb => {
        const key = cb.getAttribute("data-task") + "-" + today;
        if (taskStates[key]) cb.checked = true;
      });
    }

    function startAfternoon() {
      document.getElementById("afternoon-tasks").style.display = "block";
      const weekday = new Date().toLocaleString('de-DE', { weekday: 'long' });
      const container = document.getElementById("weekday-tasks");
      let content = "<h3>ğŸ“… Heute: " + weekday + "</h3>";

      if (["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag"].includes(weekday)) {
        content += '<label><input type="checkbox" data-task="alleine-30min" onclick="completeTask(this, null, 5)"> 30 Minuten alleine spielen</label>';
      }

      if (weekday === "Montag") {
        content += '<label><input type="checkbox" data-task="tisch-abendbrot" onclick="completeTask(this, null, 3)"> Tisch fÃ¼rs Abendbrot decken</label>';
      } else if (weekday === "Dienstag") {
        content += '<label><input type="checkbox" data-task="treppe" onclick="completeTask(this, null, 4)"> Treppe putzen</label>';
      } else if (weekday === "Mittwoch") {
        content += '<label><input type="checkbox" data-task="geschirrspueler" onclick="completeTask(this, null, 4)"> GeschirrspÃ¼ler ein-/ausrÃ¤umen</label>';
      }

      container.innerHTML = content;
      loadTaskCheckboxes();
    }

    function redeemReward(cost, rewardName) {
      if (points >= cost) {
        points -= cost;
        saveState();
        updatePointsDisplay();
        alert(`ğŸ‰ Du hast ${rewardName} eingelÃ¶st! Viel SpaÃŸ!`);
      } else {
        alert("Du hast leider nicht genug Punkte.");
      }
    }

    function redeemTabletReward() {
      const days = Object.keys(dayScores);
      const fullDays = days.filter(d => dayScores[d] >= 20); // 20 Punkte als Beispiel fÃ¼r vollstÃ¤ndigen Tag

      if (fullDays.length >= 4) {
        redeemReward(10, "1 Stunde Tabletzeit");
      } else {
        alert("Du brauchst mindestens 4 volle Tage (z.â€¯B. je 20 Punkte), um Tabletzeit zu bekommen.");
      }
    }

    updatePointsDisplay();
    loadTaskCheckboxes();
  </script>
</body>
</html>